<html>
<head>
    <meta charset="utf-8">
    <script src="face-data.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

    <script id="vertex" type="x-shader">
        //shader for vertices and points in general
        attribute vec3 aVertexPosition;
        attribute vec4 vColor;

        varying vec4 fColor;

        void main() {
            gl_Position = vec4(aVertexPosition, 1.0);
            gl_PointSize = 5.0;
            fColor = vColor;
        }
    </script>
    <script id="fragment" type="x-shader">
        //shader for fragments
        precision highp float;
        varying vec4 fColor;
        void main() {
            gl_FragColor = fColor;

        }
    </script>
    <script type="text/javascript">
    var points;
    var verts;
    function init1(){
                    /**
         * Main event loop.  
         * Initializes all buffers and handles mouse click events.
         */

        // convert the face vertices array into a set of 3d vector points
        points = new Array();
        for (var i = 0; i < face_indicies .length; i++) {
            for (var j = 0; j < 3; j++) {
                points.push(vertices[face_indicies[i][j]]);

            }
        }
        console.log(points[0]);
        //create new canvas and webgl elements
        var canvas = document.getElementById("mycanvas");
        gl = canvas.getContext("experimental-webgl");   
        gl.viewport(0, 0, canvas.width, canvas.height);
        gl.clearColor(1.0, 1.0, 1.0, 1.0);
        gl.clear(gl.COLOR_BUFFER_BIT);

        //load shaders in order to draw points and lines
        var v = document.getElementById("vertex").firstChild.nodeValue;
        var f = document.getElementById("fragment").firstChild.nodeValue;

        //compile vertex shader
        var vs = gl.createShader(gl.VERTEX_SHADER);
        gl.shaderSource(vs, v);
        gl.compileShader(vs);

        //compile fragment shader
        var fs = gl.createShader(gl.FRAGMENT_SHADER);
        gl.shaderSource(fs, f);
        gl.compileShader(fs);
        
        //initialize the WebGL program and attach the necessary shaders
        var program = gl.createProgram();
        gl.attachShader(program, vs);
        gl.attachShader(program, fs);
        gl.linkProgram(program);

        gl.useProgram(program);

        //make everything black and create an array to hold the vertices that we place on the screen
        color= [0.0, 0.0, 0.0, 1.0];
        var vbuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, vbuffer);
        verts = new Float32Array(points);                                       
        gl.bufferData(gl.ARRAY_BUFFER, verts, gl.STATIC_DRAW);
        program.aVertexPosition = gl.getAttribLocation(program, "aVertexPosition");
        gl.enableVertexAttribArray(program.aVertexPosition);
        gl.vertexAttribPointer(program.aVertexPosition, 3, gl.FLOAT, false, 0, 0);

        render();
    }
    function render(){
        /**
         * Render all of the points.
         *
         * NOTE:    This is not the optimal way to render everything, but it works.
         *          The use of LINE_LOOP gives the polygon a nice edge, but it causes an error when filling certain polygons, 
         *          because it will draw a line over what should be whitespace
         */
        gl.clear( gl.COLOR_BUFFER_BIT );
                  // Draws the object
        gl.drawArrays(gl.LINE_STRIP, 0, verts.length);
        gl.flush();
        //gl.drawArrays(gl.LINE_LOOP, 0, index);


        window.requestAnimationFrame(render);           

    }
    </script>
</head>
<body onload="init1()">
        <canvas id="mycanvas" width="800" height="500" style="border: 2px black solid;"></canvas>
</body>
</html>